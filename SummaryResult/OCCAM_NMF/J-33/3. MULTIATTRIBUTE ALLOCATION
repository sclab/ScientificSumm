in the following two sections we investigate each of these subproblems. 
(1) the preceding results signify that under certain conditions, we can divide the global optimization problem into two parts: first find a bilateral trade that maximizes unit surplus for each pair of traders (or total surplus in the non-aggregation case), and then use the  results to find a globally optimal set of trades.
theorem 5. suppose agents b and s exhibit configuration  parity, divisibility, and linear pricing, and there exists configuration x such that ˆub(x) − ˆus(x) > 0. then t ∈ mmpd (b, s) iff xt = arg max x {ˆub(x) − ˆus(x)} qt = min(¯qb, ¯qs).
theorem 4. suppose offer sets as in theorem 3, except that agents i satisfying configuration aggregation need be divisible only down to qi, rather than down to 0. then the solution to gmap consists of a set of trades, each of which employs the same  configuration as a solution to mmpd for its specified pair of traders.
then we can extend theorem 3 to allow aggregating agents to maintain aon or  minquantity offers as follows.
let mmpd (b, s) denote a modified version of mmp, where ot b and ot s are extended to assume divisibility (i.e., the offer sets are taken to be their closures under definition 1).
2. divisibility, linear pricing, and configuration parity  (definitions 1, 10, and 9), with combination offer set defined as the minimal set consistent with configuration aggregation  (definition 6).2 then the solution to gmap consists of a set of trades, each of which employs a configuration that solves mmp for its specified pair of traders.
1. no aggregation and configuration parity (definitions 4 and 9).
theorem 3. suppose that each agent"s offer set satisfies one of the following (not necessarily the same) sets of conditions.
then the solution to gmap consists of a set of trades, each of which is a solution to mmp for its specified pair of traders.
theorem 2. suppose all agents" offers exhibit no aggregation (definition 4).
112 proofs of all the following results are provided in an extended  version of this paper available from the authors.
if ot b ∩ ot s is empty, we say that mmp has no solution.
the multiattribute matching  problem (mmp) is to find a best trade for a given pair of traders, mmp(b, s) = arg max t∈ot b ∩ot s σ(t).
definition 16 (mmp).
ti ∈ oc i .
the global multiattribute  allocation problem (gmap) is to find the set of acceptable trades  maximizing total surplus, max t ∈2t x t∈t σ(t; t \ {t}) s.t.
definition 15 (gmap).
the surplus of trade t = (x, q, b, s, π) in the context of other trades t, σ(t; t), is given by ˆub b (x, q; t) − ˆus s (x, q; t).
definition 14 (surplus of a trade in context).
under linear pricing, we can equivalently write σ1 (t) = ˆub b (x) − ˆus s (x).
the unit surplus of trade t = (x, q, b, s, π) is given by σ1 (t) = σ(t)/q.
definition 13 (trade unit surplus).
note that the trade surplus does not depend on the payment, which is simply a transfer from buyer to seller.
the surplus of trade t = (x, q, b, s, π) is given by σ(t) = ˆub b (x, q) − ˆus s (x, q).
definition 12 (trade surplus).
