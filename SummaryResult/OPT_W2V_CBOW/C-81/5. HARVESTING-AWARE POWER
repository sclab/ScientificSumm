The remaining energy, RLast, is used to increase the duty cycle to some value between Dmin and Dmax in the slot with the next lower coefficient.
On the other hand, if the energy received is less than Pc, we will need to account for the extra energy used from the battery by the load, which is a function of duty cycle used in time slot i and battery efficiency factor Î·.
The value of energy generated in a particular slot is maintained as a weighted average of the energy received in the same time-slot during all observed days.
This calculation 