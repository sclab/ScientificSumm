The scoring function is adapted to the two part  scoreone for the class meta-terms and another for the text term.
To make this check efficiently we keep a sorted list of all the class paths and, at scoring time, we search the paths bottom up for a meta-term appearing in the ad.
On the query side, given the keywords and the class of a page, we compose a keyword only query by inserting one class term for each ancestor of the classes assigned to the page.
To be able to search the ads on a combination of keywords and classes 