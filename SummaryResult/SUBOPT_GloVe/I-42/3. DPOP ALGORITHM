Each other node then receives a value propagation message from its parent and chooses the assignment for its domain that has the best utility given the assignments received in the  message.
At this point the agent at node Z  simply chooses the assignment for its domain that has the best utility.
The local utility hypercube is then joined with all of the hypercubes from the child messages.
The combined hypercube contains only values for the domain for Z.
Once the agent at node Y has all utility messages , it calculates its local utility hypercube which includes domains for P 