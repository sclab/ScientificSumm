Because of our Lindahl price construction, when all agents reply ‘YES" to a demand query, we have found an optimal  allocation, analogous to the case where an agent replies ‘YES" to an equivalence query when the target function has been exactly learned.
That is, the resulting algorithm does not simply learn the  valuations exactly, then compute an optimal allocation.
Otherwise, we can obtain a  counterexample to an equivalence query given an agent"s response to a demand query.
This procedure will halt , since in the worst-case all agent valuations will be learned exactly , in which 