To make this check efficiently we keep a sorted list of all the class paths and, at scoring time, we search the paths bottom up for a meta-term appearing in the ad.
To be able to search the ads on a combination of keywords and classes we have mapped the classification match to term match and adapted the scoring function to be suitable for fast  evaluation over inverted indexes.
The scoring function is adapted to the two part  scoreone for the class meta-terms and another for the text term.
The ads are parsed into terms and each term is associated 