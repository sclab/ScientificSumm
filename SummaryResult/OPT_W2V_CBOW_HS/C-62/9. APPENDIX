If node n selects next hop k, we can write the following relation, ( ) ( )( ) ( )( ) nknn knlVpcpknlVnlV π−=++−= ,,,,, , (9) where n is node n"s profit if the path to n is chosen.
If ( )( )knlV ,, is maximal over Ln, it is also maximal over the paths in Ln+1 that don"t lead to n. This means that node n can choose some n small enough so that ( )nlV , is maximal over Ln+1, so the route will lead to k. Conversely, if ( )( )knlV ,, is not maximal over Ln, either V is greater for another of n"s next hops, in which case n will select that one in order to increase n, or V is greater for some path in Ln+1 that don"t lead to n, in which case ( )nlV , cannot be maximal for any  nonnegative n. Thus, we conclude that subgame n maximizes local welfare.
Let subgame n be the game that begins with n choosing its contract.
Then Lemma 1 gives, 1 13221 1... − − − −> − − ⋅⋅ − − − − ≥ n S l n lll P pp n pp pp pp pp pp pp T (7) This can be rearranged to give ( ) ( ) s n l P n T pp 1 1/1 − +≤ − , as required.
For subgame n, define the local welfare over paths nLl ∈ , and their possible next hops, nj < as follows, ( ) ( ) j li ipathjl pcqqujlV −−= ∈ *, , (8) where ql is the quality of path l in the set {n,…,N}, and pathjq and pj are the quality and price of the contract j has offered.
This path is chosen whenever ( )nlV , is maximal over Ln+1 and possible next hops.
Each node along the data path can cheat in route by giving data to the bargain path at price no more than lp .
That is, Ln is the set of possible routes from S to reach some node that has already moved.
We may assume the prices on the path are greater than lp or the claim follows trivially.
We show that subgame n does as well.
The rest of the claim simply recognizes that rp / is the greatest reward node i can receive for its investment, so it will not invest sums greater than this.
So node j"s temptation to cheat is at least 11 ++ − − ≥ −− −− jj l jjj ljj pp pp pcp pcp .
Node i must fall on the equilibrium data path to receive any payment.
Finally, we deduce that subgame 1, which is the entire game, maximizes local welfare, which is equivalent to actual welfare.
Let Ln be the set of possible paths restricted to nodes n,…,N.
For induction, assume that subgame n + 1 maximizes local welfare.
Label the nodes 1,2,.. N in the order in which they select contracts.
For the initial case, observe that this assumption holds for the source.
Hence, the Stackelberg price-quality game yields an optimal route.
Let the prices along the data path be ppppP nS == ,..., 21 , with marginal costs, ncc ,...,1 .
Proof of Claim 2.
Proof of Claim 4.
