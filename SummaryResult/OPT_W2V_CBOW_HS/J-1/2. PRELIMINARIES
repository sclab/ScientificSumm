It is assumed that any allocation is a disjoint union of procurement sets and therefore one can say that an  allocation partitions the players into two sets; a set of players that trade and a set of players that do not trade.
A procurement set s is the smallest set of players that is required for trade to occur.
For any player i ∈ N, we say that the set Ri ⊆ N \ {i} is a replacing set of i, if for any  procurement set s ∈ S such that i ∈ s and Ri∩s = ∅, s\{i}∪Ri ∈ S. For example, in a (homogeneous) double-sided auction (see problem B.1) the replacement set for any buyer is simply any other buyer.
For the ease of notation we will mark by vi the value of player i for any procurement set s such that vi(s) > 0.
Let X ⊂ N be a set that is closed under replacement, we say that the mechanism is an X-external mechanism, if 1.
D is a dividing function if for any  allocation A and the players" value vector v, D divides the  allocation into disjoint procurements sets s1, .
It is important to note that since replacement sets are transitive relations and since class domains also impose symmetric  relations on the replacement sets, the class of a player i, [i] is actually an equivalence class for i.
In the remainder of the paper we will assume that all of our sets which define competition in a mechanism are closed under replacement.
The function will be defined in section 4.
For any allocation A, procurement set s ⊆ A, and any i ∈ s we say Ri(A, s) is an internal  competition for i with respect to A and s, if Ri(A, s) ⊆ N \ A is a replacement set for i s.t.
The generalized trade reduction algorithms go over the procurement sets in order (from the smallest to the largest) and remove any  procurement set that does not have the desired competition when the set is reached.
We denote by W(s) the value of a procurement set s ∈ S such that W(s) = i∈s vi(s) + F(s), where F is some function that assigns a constant to procurement sets.
However, for a buyer there is no bijection between the different the procurement sets of the bundles of goods the buyer is interested in.
GTR-1 accepts problems in procurement-class based  domains, its properties are proved with a general dividing  function D. The GTR-2 algorithm accepts problems in any  domain.
Each player i, 1 ≤ i ≤ n, assigns a real value vi(s) to each possible procurement set s ∈ S. Namely, vi(s) is the valuation of player i on procurement set s. We assume that for each player i vi(s) is i"s private value and that i is a single value player, meaning that if vi(sj) > 0 then for every other sk, k = j, either vi(sk) = vi(sj) or vi(sk) = 0.
Critical value payment scheme: A  mechanism uses a critical value payment scheme if given an  allocation it charges players the minimum value they need to report to the mechanism in order to remain allocated.
So given a mechanism M that is IC and IR with allocation A, the goal of the algorithms is to turn M into an X-external mechanism.
We make the standard assumption that players have quasi-linear utility so that when player i trades and pays pi then his utility is ui(vi, b−i) = vi − pi, ui : V ⇒ R. We also assume that players are rational utility maximizers.
If i is a replacement set for j, it is not necessarily true that j is a replacement set for i.
A domain is a procurement-class  domain if the domain is a class-based domain and if for any player i such that there exists two procurement sets s1, s2 (not necessarily trading simultaneously in any allocation) such that i ∈ s1 and i ∈ s2 then there exists a bijection f : s1 → s2 such that for any j ∈ s1, f(j) is a replacement set for j in s2.
Let v−i = (v1, ..., vi−1, vi+1, ..., vn) be the vector of valuations of all the players besides player i, and let V−i be the set of all possible vectors v−i.
A domain is a class domain if for all i ∈ N and all replacement sets of i, Ri, |Ri| = 1 and for all i, j, i = j if j = Ri then i = Rj.
The set X5 denotes this  competition and is closed under replacement.
We mark the set of all  procurement sets as S and assume that any allocation is a disjoint union of procurement sets.
We define the class of a player i as the set of the player"s replacement sets and denote the class of player i by [i].
The paper denotes by O the set of possible partitions of an allocation A into procurement sets.
We will assume, without loss of generality, that there are no ties between the values of any allocations, and in  particular there are no ties between values of procurement sets.
In this case, the buyer is a class and each set of sellers of the same good is a class.
Let the value of A be W(S∗ (A)) (note that the value can depend on F).
Our two generalized trade reduction algorithms will  ensure that for any allocation we have the desired types of competition.
, Rit (A, s) such that for every iz = iq, Riz (A, s) ∩ Riq (A, s) = ∅ 4. for every procurement set s ∈ S it holds that s∩X = ∅ For general domains the choice of X can be crucial.
We denote by Ci the critical value price computed for player i.
M is (ex-post) Individually Rational (IR) if for any player i value vi, and any b−i ∈ V−i ui(vi, b−i) ≥ 0  meaning that for all possible bids of the other players, player"s i utility is non-negative.
The two algorithms are such that given an IR and IC mechanism M that solves a problem in some  domain (different domains are formally defined below), turns M into IR, IC and BB mechanism.
For any allocation A and procurement set s ⊆ A and any i ∈ s we say that Ei(A, s) is an external competition for i with respect to A and s, if Ei(A, s) ⊆ N \ A is a set s.t., T = {i} ∪ Ei(A, s) ∈ S and W(T) ≥ 0.
∪sj = A and for any player i with value vi if i ∈ sj1 and t ∈ sj2 s.t.
For any procurement set there is a  desired type of competition that depends only on the players who compose the procurement set.
The sets of trade are called procurement sets and are defined (following [2]) as follows: Definition 2.1.
We assume w.l.o.g.
For example, in a double-sided auction, a procurement set is a pair consisting of a buyer and a seller.
The value W(A) of an allocation A is the sum of the values of its most efficient  partition to procurement sets, that is W(A) = maxS∈O s∈S W(s).
M is Incentive-Compatible (IC) in  dominant strategies if for any player i, value vi and any b−i ∈ V−i, ui(vi, b−i) ≥ ui(b) meaning that for any player i, bidding vi maximized i"s utility over all possible bids of the other  players.
In appendix C we give an example where two possible choices of X yield greatly different results.
The algorithm presented finds procurement sets and removes them in iterations until the right conditions are fulfilled and the mechanism M is turned into a BB one.
The reported value bi ∈ Vi of player i is called a bid and might be different from his private value vi.
The set Vi ⊆ R is the set of all possible valuations vi.
So for any allocation A, procurement set s and player i with external competition Ei(A, s), there exists exactly one set representing the maximally valued external competition.
A set X ⊂ N is closed under  replacement if ∀i ∈ X then Ri ⊂ X The following defines the required competition needed to maintain IC, IR and BB.
Let the size of a procurement set s be denoted as |s|.
The two generalized trade reduction algorithms utilize a dividing function D which  divides allocation A into disjoint procurement sets.
For example, even for a fixed buyer and a fixed seller there are two different procurement sets consisting of different paths between the buyers and  sellers.
Although we show that X should be chosen as small as possible we do not give any  characterization of the optimality of X and this is an important open problem.
Note that since our mechanisms are normalized IR, if a player does not trade then the player pays 0 and has utility 0.
We prove the GTR-2"s properties with specific  dividing function D0.
2.1 The Model In this paper we design a method which given any IR and IC mechanism outputs a mechanism that maintains the IC and IR properties while achieving BB.
2.2 Competitions and Domains In this paper we present two generalized trade reduction algorithms.
For all players i1, .
The efficiency of the allocation ˆA is W ( ˆA) W (A) , where A is a maximal valued allocation.
j1 ≥ j2 then for any value vi > vi of player i and division by D into s1, .
In an auction for transportation slots (see problem B.7), the replacement set of an edge is a path  between the endpoints of the edge.
Note that a set can replace a single player.
Let b ∈ V be the bids of all players.
In fact even for the same domain the welfare (and revenue) can vary widely depending on how X is defined.
An optimal partition S∗ (A) is a partition that maximizes the above sum for an allocation A.
For the (homogeneous) double-sided auction each procurement set consists of a buyer and a seller.
Our algorithm presented in the next section employs a commonly used payment scheme, the critical value payment scheme.
The  algorithms order the procurements sets defined by D in order of increasing value.
Each player i ∈ X has an external competition.
We say that the allocation A is efficient if there is no other allocation with a higher value.
Since the dividing function can have a large practical impact on welfare (and revenue) the generality of GTR − 1 (albeit in special domains) can be an important practical consideration. 
An allocation rule R decides the allocation according to the reported values b ∈ V .
The next sections present two algorithms GTR-1 and  GTR2.
The right conditions that need to be met are conditions of competition among the players in the given problem.
In a  combinatorial double-sided auction a procurement set can consist of a buyer and several sellers.
In the case where F is identically zero, then W(A) = i∈A vi.
In our model there are N players divided into sets of trade.
The double sided combinatorial auction consisting of a  single multi-minded buyer and multiple sellers of heterogenous goods (see problem B.9), is a class based domain (as we have a single buyer) but not a procurement-class based domain.
The spatial-distributed market with strategic edges (see problem B.6) is not a class-based domain (and therefore not a procurement-class domain).
, sk such that i ∈ sj1 and t ∈ sj2 then j1 > j2.
The reduction of procurement sets will also be referred to as a trade reduction.
The set of all possible valuations of all the players is denoted by V = V1 × ... × Vn.
We work with mechanisms 3 Ties can be broken using the identities of the players.
A payment rule P decides i"s payment pi where P is a function P : V → RN .
Each player i /∈ X has an internal competition.
T = s \ {i} ∪ Ri(A, s) ∈ S and W(T) ≥ 0.
The formal domain definitions follow: Definition 2.9.
that there are no two allocations with the same value3 .
Mechanism M is Budget Balanced (BB) if i∈N pi ≥ 0 for any bids b ∈ V .
Intuitively, this means that replacement sets are of size 1 and the replacing relationship is symmetric.
A mechanism M defines an allocation and payment rules, M = (R, P).
21 in which players are required to report their values.
The following definitions leads us to the competition conditions we are looking for.
, it ∈ s \ X there exist Ri1 (A, s), .
In case of ties, these can be broken by using the identities of the players4 .
For some classes of mechanisms we bound the competitive approximation of welfare.
For example, F can be a (non-strategic) transportation cost in a distributed market problem.
The two generalized trade reduction algorithms presented accept problems in different domains.
A (homogeneous) double-sided auction (see problem B.1) is a procurement-class based domain.
This means that W(A) = i∈A vi +maxS∈O s∈S F(s).
5 We present some tradeoffs between the different possible sets in Appendix C. 22 Definition 2.8.
, sk s.t.
Formally, 4 The details of how to break ties in allocations are standard and are omitted.
Definition 2.10.
Furthermore, this relationship is transitive but not necessarily symmetric.
An example of such a mechanism is the VCG mechanism [17, 8, 10].
Example 2.1.
Definition 2.2.
Definition 2.3.
Definition 2.4.
Definition 2.7.
Definition 2.6.
Definition 2.5.
